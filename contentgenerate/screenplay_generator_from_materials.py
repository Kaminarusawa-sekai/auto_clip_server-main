

from langchain_community.llms.tongyi import Tongyi
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate
import dashscope


DASHSCOPE_API_KEY="sk-a48a1d84e015410292d07021f60b9acb"
import os
os.environ["DASHSCOPE_API_KEY"] = DASHSCOPE_API_KEY

from contentgenerate import llm_base
# import llm_base


def get_screenplay_from_materials(screenplay,materials):
    template='''
       ###背景：
        我们有一个短视频脚本，描述了视频的整体结构和每个部分的内容需求。此外，我们还有一个素材列表，其中包含了素材名和素材描述。现在需要利用这些信息来挑选合适的素材，并编写一个具体的剪辑脚本，确保每个镜头都能直接用于视频制作，并且内容可以直接作为旁白配音使用。

        ###目标：
        请根据提供的短视频脚本和素材列表，挑选合适的素材并编写一个具体的剪辑脚本。该剪辑脚本应包含镜头和内容，其中每个镜头每个镜头里有且只可以有一个素材，不可以有多个，内容是可以直接作为旁白配音使用的文字。注意，有的镜头可能找不到非常对应的素材，你需要使用素材库里存在的素材来进行替代，绝对不能出现素材库里没出现过的素材
        另一方面，你需要保留视频的开头语句并且原封不动的加在第一个镜头的内容的最前面里，这个开头语句是精心编写过的，你不需要修改

        ###风格：
        采用专业的视频编辑和创意策划风格，注重细节和逻辑连贯性，确保输出的剪辑脚本既实用又高效。

        ###语气：
        使用简洁明了的语气，旨在清晰传达每个镜头的具体要求，便于后续的剪辑和配音工作。

        ###受众：
        这份剪辑脚本面向的是视频剪辑师、配音演员及项目管理人员，他们需要具体的指导来高效地完成视频制作。

        ### 注意
        每个镜头里有且只可以有一个素材，不可以有多个
        如果存在镜头你觉得没有合适的素材，你需要使用素材库里存在的素材来进行替代，绝对不能出现素材库里没出现过的素材
        另一方面，你需要保留视频的开头语句并且原封不动的加在第一个镜头的内容的最前面里，这个开头语句是精心编写过的，你不需要修改

        ###输出：
        请以结构化的格式呈现结果，包括但不限于以下部分：

        剪辑脚本
        镜头（素材名）
        内容（可以直接作为旁白配音的文字）

        ###步骤：
        为了实现上述目标，请遵循以下步骤进行研究和撰写：

        ##理解短视频脚本
        仔细阅读短视频脚本，明确每个部分的主题、核心信息和情感诉求。
        ##分析素材列表
        审查提供的素材列表，理解每个素材的名称及其描述，评估其是否适合短视频脚本中的各个部分。
        ##挑选合适的素材
        根据短视频脚本的需求，从素材列表中挑选出最适合的素材，确保每个镜头都能准确传达所需的信息。
        ##编写剪辑脚本
        将选定的素材按照短视频脚本的顺序排列，并为每个素材编写相应的旁白内容。
        确保每个镜头的内容简洁明了，可以直接作为旁白配音使用。
        ##整合与优化
        整合所有选定的素材和旁白内容，形成一个连贯的剪辑脚本。
        根据初步反馈对剪辑脚本进行必要的调整，确保最终作品的质量。
        
        ###示例应用：
        假设您的
        ##短视频脚本如下：
        0-2秒：展示晒伤皮肤的问题。
        2-4秒：介绍三步高效修复方法。
        4-6秒：展示产品特写。
        6-10秒：用户反馈截图快速闪过。
        10-12秒：最后的产品特写和品牌Logo，加上一句激励性的旁白：“立即体验！”
        ##提供的素材列表如下：
        1. 素材名：晒伤皮肤对比图
        描述：展示了晒伤前后的皮肤对比，突出晒伤问题的严重性。
        
        2. 素材名：三步修复流程动画
        描述：动态展示了三步高效修复皮肤的方法。
        
        3. 素材名：产品特写
        描述：产品的高清特写镜头，展示产品的外观和特点。
        
        4. 素材名：用户反馈截图
        描述：展示了多位用户的正面反馈截图。
        
        5. 素材名：产品图片
        描述：品牌的标志和宣传语。
        
        ##编写的剪辑脚本示例：

        镜头1（晒伤皮肤对比图）
        内容：晒伤？看这里！看看晒伤前后的对比图，皮肤问题不容忽视。

        镜头2（三步修复流程动画）
        内容：只需三步，轻松修复晒伤肌肤。让我们一起来看看这神奇的修复过程。

        镜头3（产品特写）
        内容：这就是我们的[产品名称]，专为高效修复而设计。

        镜头4（用户反馈截图）
        内容：看看其他用户的反馈，效果显著，让美丽触手可及！

        镜头5（产品图片）
        内容：立即体验[产品名称]，让你的肌肤焕然一新！
        '''


    input=''''
        以下是你需要结合的
        ###短视频脚本：
        {screenplay}
        ### 素材列表
        {materials}



    '''
    template=template.format()
    input=input.format(screenplay=screenplay,materials=materials)
    res=llm_base.get_Tongyi_response(template,input)
    return res



if __name__ == '__main__':
    
    materials='''素材名: 全渠道智能客服平台概览
                描述: 此视频提供了一个全面的视角，展示了全渠道智能客服平台如何集成多种沟通渠道（如社交媒体、邮件和即时聊天），以提高客户服务效率。
                素材名: 智能分配案例研究
                描述: 通过实际案例分析，此视频详细介绍了智能分配功能是如何工作的，包括如何根据客户问题的复杂性和代理的专业知识来自动分配服务请求。
                素材名: 实时数据分析演示
                描述: 视频演示了全渠道智能客服平台中的实时数据分析工具，帮助管理者了解当前的服务水平，并基于数据做出快速决策。
                素材名: 自动化响应设置教程
                描述: 这个教程视频指导用户如何设置自动化响应，以便在非工作时间或高峰期自动回复客户咨询，确保客户始终得到及时的回应。
                素材名: 客户反馈管理策略
                描述: 探讨如何利用全渠道智能客服平台收集和分析客户反馈，以及如何将这些反馈转化为改进服务质量的具体措施。
                素材名: 跨部门协作提升客户满意度
                描述: 展示了全渠道智能客服平台如何促进不同部门之间的协作，从而更高效地解决客户问题，提高整体客户满意度。
                素材名: 移动端客服体验优化
                描述: 专注于移动端用户体验的优化方法，介绍全渠道智能客服平台如何支持移动设备，为客户提供无缝的服务体验。'''

    screenplay='''# 结构化输出

### 需求挖掘（金字塔关键词法）

#### 塔尖：行业核心词
- **智能客服平台**
- **客户服务管理**

#### 塔腰：场景细分词
- **中小企业客服管理**
- **电商客户体验优化**
- **大型企业数字化转型**

#### 塔基：长尾需求词
- **多渠道集成解决方案**
- **实时监控与报表分析**
- **快速部署与系统对接**
- **自动化客服流程**

### 情绪转折情节设计（情绪坐标轴）

#### X轴：情绪强度 - 从弱到强
#### Y轴：情绪类型 - 定义情绪类型为积极或消极，爆款集中在强消极情绪（如焦虑、压力）转向强积极情绪（如解决、成功）

**具体情节示例：**
- **开头（强消极情绪）：** CEO在忙碌的一天中突然接到紧急客户问题，感到极度焦虑和压力。
- **中间（过渡）：** CEO通过使用全渠道智能客服平台，迅速解决了问题，并实时监控客服团队的表现，逐步缓解压力。
- **结尾（强积极情绪）：** CEO不仅解决了问题，还提高了团队效率，增强了客户满意度，最终实现业务增长。

### 短视频脚本

#### 开头语句
“deepseek又放大招了！你是否曾因客户问题而感到手忙脚乱？今天，我们将展示如何通过全渠道智能客服平台轻松应对各种挑战。”

#### 主体内容

1. **场景描述：**
   - **镜头一：忙碌的CEO办公室**
     - 视觉元素：蓝色和绿色为主色调的现代办公环境，CEO坐在桌前处理各种事务。
     - 对话/旁白：“每天都有无数的任务等待处理，突然一个紧急客户问题打乱了一切。”
     - 音乐：轻快但略带紧张感的背景音乐。

   - **镜头二：CEO使用智能客服平台**
     - 视觉元素：屏幕显示智能客服平台界面，展示多渠道集成、智能分发等功能。
     - 对话/旁白：“只需几分钟，问题迎刃而解。实时监控功能让一切尽在掌握。”
     - 音乐：节奏逐渐加快，充满活力。

2. **功能演示：**
   - **镜头三：可视化报表工具**
     - 视觉元素：动态图标展示数据驱动决策的过程，图表和数据流动画。
     - 对话/旁白：“利用可视化报表工具，您可以直观地了解客服绩效，做出更明智的决策。”
     - 音乐：轻快且激励人心。

3. **用户案例展示：**
   - **镜头四：传统制造企业的转变**
     - 视觉元素：工厂车间到现代化办公区的转变，员工操作智能客服平台的画面。
     - 对话/旁白：“一家传统制造企业通过引入智能客服平台，实现了客服流程的自动化和智能化，显著提高了客户满意度。”
     - 音乐：激昂且鼓舞人心。

#### 结尾总结
“试试全渠道智能客服平台，让您的业务更加高效、智能，推动整体业务升级！立即行动，点赞、分享并订阅我们，获取更多实用信息！”

### 总结

通过结合热点词“美白”和改写的热点开头语“deepseek又放大招了”，我们将主题聚焦于全渠道智能客服平台的核心优势，同时通过情绪转折情节设计，从强消极情绪转向强积极情绪，增强观众的情感共鸣。视觉记忆点的设计确保了品牌的统一性和专业性 ，使视频更具吸引力和说服力。
'''
    get_screenplay_from_materials(screenplay,materials)



